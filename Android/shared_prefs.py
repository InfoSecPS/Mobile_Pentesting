import subprocess
import sys

def get_shared_prefs(package_name):
    # Construct the command to be run in the shell
    shell_command = f"su -c 'cp -R /data/data/{package_name}/shared_prefs /sdcard/temp_prefs'"
    
    try:
        # Execute the command in an interactive shell
        process = subprocess.Popen(['adb', 'shell'], stdin=subprocess.PIPE, stdout=subprocess.PIPE, stderr=subprocess.PIPE, text=True)
        stdout, stderr = process.communicate(shell_command)
        
        if process.returncode != 0:
            print(f"Error executing command: {stderr}")
            return
        
        # Now pull the files from /sdcard/temp_prefs
        subprocess.run(f"adb pull /sdcard/temp_prefs .", shell=True, check=True)
        
        # Clean up
        subprocess.run("adb shell su -c 'rm -rf /sdcard/temp_prefs'", shell=True, check=True)
        
        print(f"Successfully downloaded shared_prefs for {package_name}")
    except subprocess.CalledProcessError as e:
        print(f"Error: {e}")

if __name__ == "__main__":
    if len(sys.argv) != 2:
        print("Usage: python script.py <package_name>")
        sys.exit(1)
    
    package_name = sys.argv[1]
    get_shared_prefs(package_name)
